<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>מערכת ניהול עסק</title>

  <link rel="stylesheet" href="style.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!-- חובה כדי שהאפליקציה תותקן -->
  <link rel="manifest" href="manifest.json">

  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('service-worker.js')
        .catch(err => console.log("SW error:", err));
    }
  </script>
</head>

<body>

  <!-- תפריט עליון -->
  <header>
    <h1>מערכת ניהול עסק</h1>
    <nav>
      <button class="primary-btn" onclick="showSection('dashboard')">דשבורד</button>
      <button class="primary-btn" onclick="showSection('expenses')">הוצאות</button>
      <button class="primary-btn" onclick="showSection('inventory')">מלאי</button>
      <button class="primary-btn" onclick="showSection('purchases')">רכש</button>
      <button class="primary-btn" onclick="showSection('reports')">דוחות</button>
      <button class="primary-btn" onclick="showSection('categories')">קטגוריות</button>
    </nav>
  </header>

  <!-- דשבורד -->
  <section id="dashboard" class="section">
    <h2>דשבורד</h2>

    <div class="cards">
      <div class="card panel">
        <h3>סה״כ הכנסות</h3>
        <p id="cardIncome">0 ₪</p>
      </div>

      <div class="card panel">
        <h3>סה״כ הוצאות</h3>
        <p id="cardExpenses">0 ₪</p>
      </div>

      <div class="card panel">
        <h3>רווח נקי</h3>
        <p id="cardProfit">0 ₪</p>
      </div>
    </div>

    <canvas id="incomeChart"></canvas>
    <canvas id="expenseChart"></canvas>
    <canvas id="categoryChart"></canvas>
    <canvas id="subCategoryChart"></canvas>
  </section>

  <!-- הוצאות -->
  <section id="expenses" class="section" style="display:none;">
    <h2>ניהול הוצאות</h2>

    <div class="form-panel panel">
      <input id="expenseAmount" type="number" placeholder="סכום">
      <input id="expenseDesc" type="text" placeholder="תיאור">
      <select id="expenseCategory" onchange="updateSubCategorySelect('expenseSubCategory', this.value)"></select>
      <select id="expenseSubCategory"></select>
      <button class="primary-btn" onclick="saveExpense()">שמור</button>
    </div>

    <h3>סינון</h3>
    <select id="filterCategory" onchange="renderExpenses()"></select>
    <select id="filterSubCategory" onchange="renderExpenses()"></select>

    <div id="expenseList" class="list-panel"></div>

    <h3>סיכום לפי קטגוריות</h3>
    <table>
      <thead>
        <tr>
          <th>קטגוריה</th>
          <th>תת־קטגוריה</th>
          <th>סה״כ</th>
        </tr>
      </thead>
      <tbody id="categorySummaryBody"></tbody>
    </table>
  </section>

  <!-- מלאי -->
  <section id="inventory" class="section" style="display:none;">
    <h2>מלאי</h2>

    <div class="form-panel panel">
      <input id="itemName" type="text" placeholder="שם מוצר">
      <input id="itemQty" type="number" placeholder="כמות">
      <button class="primary-btn" onclick="addItem()">הוסף</button>
    </div>

    <div id="inventoryList" class="list-panel"></div>
  </section>

  <!-- רכש -->
  <section id="purchases" class="section" style="display:none;">
    <h2>רכש</h2>

    <div class="form-panel panel">
      <input id="purchaseItem" type="text" placeholder="מוצר">
      <input id="purchaseQty" type="number" placeholder="כמות">
      <button class="primary-btn" onclick="addPurchase()">הוסף</button>
    </div>

    <div id="purchaseList" class="list-panel"></div>
  </section>

  <!-- דוחות -->
  <section id="reports" class="section" style="display:none;">
    <h2>דוחות</h2>

    <button class="primary-btn" onclick="showReports()">הצג דוחות</button>
    <button class="secondary-btn" onclick="downloadCSV()">ייצוא CSV</button>
    <button class="secondary-btn" onclick="downloadTXT()">ייצוא TXT</button>

    <div id="reportContent" class="panel"></div>
  </section>

  <!-- קטגוריות -->
  <section id="categories" class="section" style="display:none;">
    <h2>ניהול קטגוריות</h2>

    <div class="form-panel panel">
      <input id="newCategoryName" type="text" placeholder="שם קטגוריה">
      <button class="primary-btn" onclick="addCategory()">הוסף</button>
    </div>

    <div id="categoryManager" class="list-panel"></div>
  </section>

  <script src="app.js"></script>
</body>
</html>